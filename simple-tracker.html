<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; }
        #map { height: 70vh; width: 100%; }
        .controls { padding: 20px; text-align: center; background: #f5f5f5; }
        .stats { padding: 10px; background: white; border-radius: 8px; margin: 10px; display: inline-block; }
        button { padding: 12px 24px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        .start { background: #4CAF50; color: white; }
        .stop { background: #f44336; color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="controls">
        <div class="stats">
            <strong>Distance:</strong> <span id="distance">0.00</span> km
        </div>
        <div class="stats">
            <strong>Time:</strong> <span id="timer">00:00:00</span>
        </div>
        <br>
        <button id="start" class="start">Start Run</button>
        <button id="stop" class="stop hidden">Stop Run</button>
    </div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoicGl5dXNoZ2FyZzE4NTciLCJhIjoiY21nZXRzeGdxMDE4djJrcjB0bTY2M293eSJ9.NbsLrU8FssZSgfEwy3KEkg';
        
        let map, watchId, coords = [], distance = 0, startTime, timer;
        
        // Initialize map
        map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [0, 0],
            zoom: 15
        });

        map.on('load', () => {
            map.addSource('route', {
                type: 'geojson',
                data: { type: 'LineString', coordinates: [] }
            });
            
            map.addLayer({
                id: 'route',
                type: 'line',
                source: 'route',
                paint: { 'line-color': '#ff0000', 'line-width': 4 }
            });

            // Get user location
            navigator.geolocation.getCurrentPosition(pos => {
                map.setCenter([pos.coords.longitude, pos.coords.latitude]);
                
                // Add live location marker
                new mapboxgl.Marker({ color: '#4CAF50' })
                    .setLngLat([pos.coords.longitude, pos.coords.latitude])
                    .addTo(map);
            });
        });

        // Start tracking
        document.getElementById('start').onclick = () => {
            document.getElementById('start').classList.add('hidden');
            document.getElementById('stop').classList.remove('hidden');
            
            coords = [];
            distance = 0;
            startTime = Date.now();
            
            timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const h = Math.floor(elapsed / 3600).toString().padStart(2, '0');
                const m = Math.floor((elapsed % 3600) / 60).toString().padStart(2, '0');
                const s = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById('timer').textContent = `${h}:${m}:${s}`;
            }, 1000);

            watchId = navigator.geolocation.watchPosition(pos => {
                const newCoord = [pos.coords.longitude, pos.coords.latitude];
                
                if (coords.length > 0) {
                    const lastCoord = coords[coords.length - 1];
                    distance += getDistance(lastCoord, newCoord);
                    document.getElementById('distance').textContent = distance.toFixed(2);
                }
                
                coords.push(newCoord);
                map.getSource('route').setData({ type: 'LineString', coordinates: coords });
                map.panTo(newCoord);
            }, null, { enableHighAccuracy: true });
        };

        // Stop tracking
        document.getElementById('stop').onclick = () => {
            document.getElementById('stop').classList.add('hidden');
            document.getElementById('start').classList.remove('hidden');
            
            navigator.geolocation.clearWatch(watchId);
            clearInterval(timer);
            
            alert(`Run completed! Distance: ${distance.toFixed(2)} km`);
        };

        // Calculate distance between two coordinates
        function getDistance([lon1, lat1], [lon2, lat2]) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + 
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
    </script>
</body>
</html>